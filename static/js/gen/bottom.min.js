$(window).on("resize scroll",function(){styleNavigation();}).trigger('resize');function styleNavigation(){var bounds=[],ieScrollTop=document.documentElement.scrollTop,scrollTop=document.body.scrollTop==0?ieScrollTop:document.body.scrollTop;$('.invert-navbar').each(function(){bounds.push([$(this).offset().top,$(this).offset().top+$(this).height()]);});for(var i=0;i<bounds.length;i++){if(scrollTop>=bounds[i][0]-50&&scrollTop<=bounds[i][1]+25){$('.navbar-invertable').addClass('navbar-inverse');$('.navbar-invertable').removeClass('navbar-light');return;}}
$('.navbar-invertable').removeClass('navbar-inverse');$('.navbar-invertable').addClass('navbar-light');}
$(window).on("resize scroll",function(){fadeJumbotrons();}).trigger('resize');function fadeJumbotrons(){$('.jumbotron-fade').each(function(){var ieScrollTop=document.documentElement.scrollTop,scrollTop=document.body.scrollTop==0?ieScrollTop:document.body.scrollTop,visiblePixels=$(this).height()-scrollTop-$(this).offset().top,visiblePercent=Math.round(visiblePixels*100/$(this).height()),brightness=visiblePercent<100?visiblePercent/2:100,opacity=visiblePercent<100?visiblePercent/10:1;$(this).css('filter','brightness('+brightness+'%)');$(this).children().css('opacity',opacity);});}
$(window).on("resize",function(){displayScrollButtons();}).trigger('resize');function displayScrollButtons(){$('.btn-scroll').each(function(){var target=$($(this).data('target'))[0];if(target.offsetWidth<target.scrollWidth){$(this).css('visibility','visible');}else{$(this).css('visibility','hidden');}});}
(function(){if($('.global-stat').length){$.ajax({url:'/api/globalstats',dataType:'json'}).done(function(results){$('#n-volunteers').html(results.n_users);$('#n-contributions').html(results.n_task_runs);$('#n-projects').html(results.n_projects);});}}());$('img').on("error",function(){var rand=Math.floor((Math.random()*10)+1),url='http://placekitten.com/400/400?image='+rand;$(this).attr('src',url);});if($('#uploadPreview').length){var $uploadCrop;var $preview=$('#uploadPreview');$uploadCrop=$preview.croppie({viewport:{width:$preview.width()||300,height:$preview.height()||300,type:$preview.hasClass('crop-circle')?'circle':'square'},boundary:{width:$preview.width()||300,height:$preview.height()||300},update:function(data){$("#x1").val(Math.floor(data.points[0]));$("#y1").val(Math.floor(data.points[1]));$("#x2").val(Math.floor(data.points[2]));$("#y2").val(Math.floor(data.points[3]));}});$('#avatar').on('change',function(){var input=this;if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(evt){$uploadCrop.croppie('bind',{url:evt.target.result});};reader.readAsDataURL(input.files[0]);}});}
$('a[href*=\\#]:not([href="#"]):not([data-toggle="tab"])').on('click',function(evt){var anchor=$($(this).attr('href'));setTimeout(function(){$('html, body').animate({scrollTop:anchor.offset().top},1000);},100);evt.preventDefault();});$('.progress-circle:not(.progress-circle-white)').each(function(){var value=parseFloat($(this).data('progress')/100);$(this).circleProgress({value:value,fill:'#D00000',size:180});});$('.progress-circle-white').each(function(){var value=parseFloat($(this).data('progress')/100);$(this).circleProgress({value:value,fill:'#FFF',size:180});});$('#get-s3-bucket').on('click',function(){var files=[],bucketName=$('#bucket').val(),filesInput=document.getElementById("files");filesInput.innerHTML=null;$('#objects').empty();$.get('/amazon/bucket/'+bucketName).done(function(objects){objects.forEach(function(object){var row=$('<tr class="object" style="cursor:pointer;"><td>'+object+'</td></tr>');$('#objects').append(row);});notify("Click on the rows containing the images you want to import.",'info');$(".object").each(function(){var objectDomElement=$(this),objectName=$(this).text();objectDomElement.off('click').on('click',function(evt){evt.preventDefault();objectDomElement.toggleClass('table-success');if(objectDomElement.hasClass('table-success')){if(files.indexOf(objectName)===-1){files.push(objectName);}}else{files.splice(files.indexOf(objectName),1);}
filesInput.innerHTML=null;files.forEach(function(file,index){var element=document.createElement("li"),content=document.createTextNode(file),input=document.createElement('input');input.id="files-"+index;input.type="hidden";input.name="files-"+index;input.value=file;element.appendChild(input);element.appendChild(content);filesInput.appendChild(element);});});});$('#objects-container').show();}).fail(function(resp){if(resp.status===403){notify("Oops... it seems that bucket is private.",'error');}else if(resp.status===404){notify("Oops... we could not find that bucket.",'error');}else if(resp.status===500){notify("Internal server error, please check that the bucket name is valid.",'error');}});});class ProjectShuffle{constructor(gridSelector,tableSelector){this.grid=$(gridSelector);this.table=$(tableSelector);this.sizer=this.grid.find('.grid-item').first();this.shuffle=new shuffle(this.grid,{itemSelector:'.grid-item',sizer:this.sizer});this.run();}
_sortGridItems(){let element=$("#shuffle-sort option:selected")[0],reverse=element.getAttribute("data-reverse")||false,options={by:function(element){let res=element.getAttribute("data-sortby");return $.isNumeric(res)?parseFloat(res):res;},reverse:reverse};this.shuffle.sort(options);};_sortTableRow(){let element=$("#shuffle-sort option:selected")[0],reverse=element.getAttribute("data-reverse")||false,sortBy=element.getAttribute("data-sortby");let sortedTable=this.table.find('tbody tr').sort(function(a,b){if(reverse){return b.getAttribute(`data-${sortBy}`)-a.getAttribute(`data-${sortBy}`);}else{return a.getAttribute(`data-${sortBy}`)-b.getAttribute(`data-${sortBy}`);}});this.table.find('tbody').first().html(sortedTable);this.table.find('tbody').append(this.table.find('tbody tr.no-data'));};_search(elem){let text=$('#shuffle-search').val().toLowerCase(),words=text.split(' ');for(var i=0;i<words.length;i++){if(elem.text().toLowerCase().indexOf(words[i])===-1){return false;}}
return true;}
_filter(elem){let filter=true;$('.shuffle-checkbox').each((i,checkbox)=>{let checked=checkbox.checked,group=checkbox.getAttribute('data-group');if(checked&&!elem.data('groups').includes(group)){filter=false;}});return filter;}
_showGridPlaceholders(){if(this.grid.find('.shuffle-item--visible').length){$('#shuffle-grid-placeholders').hide();}else{$('#shuffle-grid-placeholders').show();}}
run(){this.table.find('tbody tr:not(.no-data)').each((i,row)=>{if(this._filter($(row))&&this._search($(row))){this._sortTableRow();$(row).removeClass('hidden');}else{$(row).addClass('hidden');}});this.shuffle.filter((elem)=>{return this._filter($(elem))&&this._search($(elem));});this._sortGridItems();this._showGridPlaceholders();}}
if($('.shuffle-controls').length===1){let projectShuffle=new ProjectShuffle('#shuffle-grid','#shuffle-table');$('.shuffle-control').on('change keyup',function(){projectShuffle.run();});$('.shuffle-tab').on('shown.bs.tab',function(){projectShuffle.run();projectShuffle.shuffle.update();});$(window).on('load',function(){projectShuffle.shuffle.update();})}
$('.toggle-featured').on('click',function(){var projectId=$(this).data("project-id"),featured=$(this).text()==="Remove",method=featured?"DELETE":"POST",_this=$(this);$.ajax({type:method,url:'/admin/featured/'+projectId,dataType:'json'}).done(function(){_this.html(featured?"Add":"Remove");}).fail(function(jqXHR){notify(jqXHR.responseText,'error');});});function searchRow(row,words){for(var i=0;i<words.length;i++){if(row.text().toLowerCase().indexOf(words[i])===-1){return false;}}
return true;}
$('.search-table[data-target]').on('change keyup',function(evt){var tableId=$(this).data('target'),text=evt.target.value.toLowerCase(),words=text.split(' ');$(tableId).find('tbody tr:not(.no-data)').each(function(){if(searchRow($(this),words)){$(this).removeClass('hidden');}else{$(this).addClass('hidden');}});});$('.btn-scroll').on('click',function(){var target=$(this).data('target'),direction=$(this).data('direction');if(direction=='left'){$(target).animate({scrollLeft:$(target).scrollLeft()-400},300);}else if(direction=='right'){$(target).animate({scrollLeft:$(target).scrollLeft()+400},300);}});$('[data-toggle="popover"]').popover();$('[data-toggle="tooltip"]').tooltip();$('a[href*=\\#].tab-control').on('click',function(evt){var link=$(this).attr('href');$(link).show();$(link).siblings().hide();$(this).parent().siblings().removeClass('active');$(this).parent().addClass('active');evt.preventDefault();});$('.hamburger').on('click',function(evt){switchIcons($(this));switchColours($(this));});$(window).on("resize",function(){$('.hamburger').each(function(){switchIcons($(this));});});function switchColours(elem){var targetId=elem.data('target'),timeout=elem.hasClass('is-active')?50:300;$(targetId).toggleClass('show');elem.toggleClass('is-active');elem.blur();setTimeout(function(){elem.toggleClass('white');},timeout);}
function switchIcons(elem){if($(window).width()>992){elem.removeClass('hamburger--collapse');elem.addClass('hamburger--arrow');}else{elem.addClass('hamburger--collapse');elem.removeClass('hamburger--arrow');}}
$('[data-toggle="sidebar-collapse"]').on('click',function(evt){let target=$(this).data('target');$(target).toggleClass('active');evt.preventDefault();});