{% import "_helpers/_general.html" as general_helpers %}

{% macro render_grid(projects, shuffle=False) %}
<div {% if not shuffle %}class="row overlay-cards"{% else %}class="row shuffle-grid overlay-cards" id="project-grid" data-initial-group="incomplete"{% endif %}>
    {% for project in projects %}
    <div class="col-md-6 col-xl-4 grid-item" data-groups='["{% if project.overall_progress < 100 %}in{% endif %}complete"]'
        data-created="{{ general_helpers.format_date(project.created) }}" data-progress="{{ project.overall_progress }}"
        data-last-activity="{{ project.last_activity_raw }}" data-n-volunteers="{{ project.n_volunteers }}"
        {%- if shuffle and project.overall_progress == 100 %}style="visibility: hidden"{% endif %}>
        
        <div class="card text-center">
            <a href="{{ url_for('project.details', short_name=project.short_name) }}">
                <div class="card-img-overlay-wrapper">
                    {{ render_thumbnail(project, class='card-img-top img-fluid') }}
                    <div class="card-img-overlay text-white d-flex flex-column justify-content-center align-content-center">
                        <div data-progress="{{ project.overall_progress | round | int }}" class="progress-circle progress-circle-white">
                            <p class="text-white">{{ project.overall_progress | round | int }}%</p>
                        </div>
                    </div>
                </div>
            
                <div class="card-block">
                    <h5 class="card-title font-weight-bold text-body">{{ project.name }}</h5>
                    <p class="card-text text-body">{{ project.description }}</p>
                    <p class="card-text text-muted mt-3">
                        <span class="fa fa-users mr-1"></span>{{ project.n_volunteers }}
                        <span class="fa fa-tasks ml-4 mr-1"></span>{{ project.n_tasks }}
                    </p>
                </div>
                <div class="card-footer text-uppercase">
                    <button type="button" role="button" class="btn btn-outline-primary">
                        Contribute
                    </button>
                </div>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

{% macro render_grid_shuffle_controls() %}
<div class="row d-flex flex-row align-items-center justify-content-around">
    <div class="col-xl-4 col-md-6 text-center text-lg-left">
        <label class="my-2">
            <input checked="true" class="shuffle-checkbox" data-toggle="toggle" data-width="75" data-onstyle="info" type="checkbox" id="show-all" data-group="incomplete">
            <span class="ml-1">Hide completed</span>
        </label>
    </div>
    <div class="col-xl-4 col-md-6 text-center text-xl-left text-lg-right">
        <div class="d-flex flex-row form-group my-2 align-items-center">
            <label for="project-sort-options" class="mr-2 mb-0">Sort:</label>
            <select class="shuffle-sort custom-select" id="project-sort-options">
                <option value="progress" data-sortby="progress">Most Help Needed</option>
                <option value="progress-reverse" data-sortby="progress" data-reverse="true">Closest to Completion</option>
                <option value="n-volunteers" data-sortby="n-volunteers" data-reverse="true">Most Popular</option>
                <option value="created" data-sortby="created" data-reverse="true">Most Recently Launched</option>
                <option value="last-activity" data-sortby="last-activity" data-reverse="true">Most Recently Active</option>
            </select>      
        </div>
    </div>
    <div class="col-xl-4 col-lg-12 text-center text-lg-right my-2">
        <input type="text" class="form-control rounded-oblong shuffle-search" placeholder="Search">
    </div>
</div>
{% endmacro %}

{% macro render_grid_complete_placeholder() %}
<div class="text-center shuffle-grid-placeholder">
    <span class="icon icon-in-love icon-5x"></span>
    <p class="display-5 my-1">Success</p>
    <div class="alert alert-success my-4">
        All projects in this category have been completed! If you want to see the statistics or results
        for a particular project just toggle the "Hide completed" button above.
    </div>
    <a class="btn btn-outline-primary btn-lg mt-2" href={{ url_for('project.index') }} role="button">Choose Another Category</a>
    </div>
</div>
{% endmacro %}

{% macro render_thumbnail(project, upload_method, class, style, width='200', id=None) %}
    {% if project.info.container -%}
        {% if upload_method == 'rackspace' -%}
        <img {% if id %}id="{{ id }}"{% endif %} class="{{ class }}" style="{{ style }}" src="{{ url_for('rackspace', filename=project.info.thumbnail, container=project.info.container) }}" alt="{{ project.name }} thumbnail">
        {% else -%}
        <img {% if id %}id="{{ id }}"{% endif %} class="{{ class }}" style="{{ style }}" src="{{ url_for('uploads.uploaded_file', filename=(project.info.container + '/' + project.info.thumbnail)) }}" alt="{{ project.name }} thumbnail">
        {% endif -%}
    {% elif project.info.thumbnail -%}
        <img {% if id %}id="{{ id }}"{% endif %} class="{{ class }}" style="{{ style }}" src="{{ project.info.thumbnail }}" alt="{{ project.name }} thumbnail">
    {% else -%}
        <img {% if id %}id="{{ id }}"{% endif %} class="{{ class }}" style="{{ style }}" src="http://placekitten.com/400/400?image=1" alt="{{ project.name }} thumbnail">
    {% endif -%}
{% endmacro %}
