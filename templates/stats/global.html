{% extends "_layouts/default.html" %}
{% set active_page = "statistics" %}
{% import "_helpers/_general.html" as general_helpers %}
{% import "_helpers/_card.html" as card_helpers %}
{% set jstop = True %}

{% block content %}
{% assets filters="jsmin", output="js/gen/stats.min.js",
    "../node_modules/pace-progress/pace.js",
    "../node_modules/jquery/dist/jquery.js",
    "../node_modules/tether/dist/js/tether.js",
    "../node_modules/bootstrap/dist/js/bootstrap.js",
    "../node_modules/pnotify/dist/pnotify.js",
    "../node_modules/pnotify/dist/pnotify.buttons.js",
    "../node_modules/chart.js/dist/Chart.js",
    "../node_modules/leaflet/dist/leaflet.js",
    "../node_modules/leaflet.markercluster/dist/leaflet.markercluster.js",
    "js/stats.js",
    "js/notify.js"
    %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}

<div class="card text-center">
    {{ card_helpers.render_title('Most Active Volunteers') }}
    <div class="card-block pt-0">
        <div class="canvas-container">
            <canvas></canvas>
        </div>
    </div>
    <div class="card-footer bg-white text-center">
        <a class="btn btn-outline-primary" href="{{ url_for('leaderboard.index') }}" role="button">View Leaderboard</a>
    </div>
</div>


    <div id="summary" class="col-xs-12 padding-bottom-sm">
        <div class="white-panel inset-shadow-white">
            <h3 class="text-center text-stats"></h3>
        </div>
    </div>

    <section id="stats" style="display: none;">

        <div id="leaderboard" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Most Active Volunteers</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>
                <div class="text-center padding-top-xs">
                    <a class="btn btn-danger" href="{{url_for('leaderboard.index')}}">View Leaderboard</a>
                </div>
            </div>
        </div>

        <div id="locations-summary" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h3 class="text-stats text-center"></h3>
            </div>
        </div>

        <div id="locations" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Locations of Active Volunteers</h4>
                <div id="map" style="height:480px;"></div>
            </div>
        </div>

        <div id="top-countries" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Most Active Countries</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>

                <div class="text-center padding-top-xs padding-bottom-sm">
                    <a class="btn btn-danger" href="#all-countries" data-toggle="collapse"
                       aria-expanded="false" aria-controls="all-countries">View All Countries</a>
                </div>
                <div id="all-countries" class="collapse">
                    <table class="table table-stripped table-condensed table-hover table-responsive">
                        <thead>
                            <tr>
                                <th class="text-center">Country</th>
                                <th class="text-center">Contributions</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="daily-contributions" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Daily Contributions</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>
            </div>
        </div>

        <div id="top-users-this-week" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Most Active Volunteers This Week</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>
            </div>
        </div>

        <div id="daily-volunteers" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Daily Volunteers</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>
            </div>
        </div>

        <div class="stats-row">

            <div id="proportion-auth-users" class="col-md-4 col-xs-12 padding-bottom-sm">
                <div class="white-panel inset-shadow-white">
                    <h4 class="padding-bottom-sm text-center">Proportion of Authenticated Users</h4>
                    <div class="canvas-container">
                        <canvas></canvas>
                    </div>
                    <div class="legend-container padding-top-sm"></div>
                </div>
            </div>

            <div id="dow" class="col-md-4 col-xs-12 padding-bottom-sm">
                <div class="white-panel inset-shadow-white">
                    <h4 class="padding-bottom-sm text-center">Contributions per Day of the Week</h4>
                    <div class="canvas-container">
                        <canvas></canvas>
                    </div>
                </div>
            </div>

            <div id="top-10-percent" class="col-md-4 col-xs-12 padding-bottom-sm">
                <div class="white-panel inset-shadow-white">
                    <h4 class="padding-bottom-sm text-center">Most Active 10% of Volunteers</h4>
                    <div class="canvas-container">
                        <canvas></canvas>
                    </div>
                    <div class="legend-container padding-top-sm"></div>
                </div>
            </div>

        </div>

        <div id="hourly-activity" class="col-xs-12 padding-bottom-sm">
            <div class="white-panel inset-shadow-white">
                <h4 class="padding-bottom-sm text-center">Total Hourly Activity</h4>
                <div class="canvas-container">
                    <canvas></canvas>
                </div>
            </div>
        </div>

    </section>

{{ stats }}
<script>
$(function(){
    let stats                  = {{ stats | tojson }},
        locs                   = {{ locs | tojson }},
        tasks                  = {{ tasks | tojson }},
        projects               = {{ projects | tojson }},
        users                  = {{ users | tojson }},
        top5_users_24_hours    = {{ top5_users_24_hours | tojson }},
        top5_projects_24_hours = {{ top5_projects_24_hours | tojson }};
    
    $.ajax({
        url: '/leaderboard',
        dataType: 'json'
    }).done(function(results) {
         console.log(results);
    }).fail(function(err) {
        console.log(err)
    });
});
$(window).on("resize", function() {
    resizeStatsRow();
}).resize();
</script>


{% endblock %}